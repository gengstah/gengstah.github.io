---
title: 'December 2025 Patch Tuesday'
date: 2025-12-10
permalink: /posts/2025/12/patch-tuesday/
tags:
  - windows
  - 1-day
  - patch diff
  - cldflt.sys
---

# CVE-2025-62221 - Windows Cloud Files Mini Filter Driver Elevation of Privilege Vulnerability
A Windows Cloud Files Mini Filter Driver (`cldflt.sys`) bug ([CVE-2025-62221](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-62221)) is being actively exploited this month and has been patched in this month's Patch Tuesday. In October, there was a TOCTOU bug ([CVE-2025-55680](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-55680)) patched in the same driver. This time around, the bug is a Use-after-Free (UaF). I looked at the patch made to the driver and shared my findings in this blog.

## Diff
The diff I generated using ghidriff is available at [cldflt.10.0.19041.6456.sys-cldflt.10.0.19045.6691.sys.md](https://diffpreview.github.io/?03457f16c27962139a7ce45baf4d76e8)

## Analysis
Looking at the diff, the vulnerability lies in the `HsmiGrantLockRequest` function. The function manages cross-references between two lists:
1. Temporary list (`local_48`): Created temporarily during function execution
2. Persistent list (at `param_1 + 0x40`): Lives beyond the function's lifetime

Around label `LAB_8` in the old code, nodes from the temporary list are linked into the persistent list:
```c
ppppuVar19[4] = ppppuVar4;  // persistent list node -> temp list node
ppppuVar4[5] = ppppuVar19;  // temp list node -> persistent list node
```

Then at cleanup (`LAB_3`), the temporary list nodes are freed:
```c
HsmiFreePropertyLock((longlong)ppppuVar1);  // FREE the temp node
```

The persistent list still has pointers (at offset `[4]`) pointing to the now-freed temporary list nodes. Any subsequent access through these pointers would trigger a use-after-free.


## Patch
The patch adds cleanup code before freeing temp nodes:
```c
ppppppuVar13 = (undefined8 ******)ppppppuVar1[5];  // Get linked persistent node
if (ppppppuVar13 != (undefined8 ******)0x0) {      // If cross-link exists
    ppppppuVar13[4] = (undefined8 *****)0x0;       // NULL out the back-pointer
}
ExFreePoolWithTag(ppppppuVar1,0x72507348);         // NOW it's safe to free
```
Additionally, the patch adds code to free the dynamically allocated owner arrays stored in temp nodes:
```c
if (*(int *)(local_48 + 4) != 0) {              // If array was allocated
    ExFreePoolWithTag(*pppppppuVar6,0x72507348); // Free it first
}
```

## Conclusion
This bug is interesting especially because it is actively exploited and I want to learn mini filter driver exploitation. I am doing some more analysis on the topic & I initially plan and started to write an in-depth analysis in this blog post but then decided it deserves a blog post on its own. Hopefully, I'll be able craft my own exploit in the coming weeks (months?), time willing (and skill willing). 

## References
- https://www.zerodayinitiative.com/blog/2025/12/9/the-december-2025-security-update-review
